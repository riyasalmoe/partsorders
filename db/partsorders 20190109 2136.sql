--
-- Script was generated by Devart dbForge Studio for MySQL, Version 8.0.124.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 09/01/2019 09:36:05 PM
-- Server version: 5.5.5-10.1.21-MariaDB
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

DROP DATABASE IF EXISTS partsorders;

CREATE DATABASE partsorders
	CHARACTER SET utf8
	COLLATE utf8_general_ci;

--
-- Set default database
--
USE partsorders;

--
-- Create table `users`
--
CREATE TABLE users (
  EmailAddress VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  FullName VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  Password VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  IsActive BIT(1) DEFAULT b'0',
  IsEnabled BIT(1) DEFAULT b'0',
  IsAuthorized BIT(1) DEFAULT b'0',
  PRIMARY KEY (EmailAddress)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 1489,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci,
COMMENT = 'user management table';

DELIMITER $$

--
-- Create procedure `VerifyUser`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE VerifyUser(IN EmailID VARCHAR(100), IN Pwd VARCHAR(100))
BEGIN

SELECT
  COUNT(partsorders.users.EmailAddress) IsValid
FROM partsorders.users
WHERE partsorders.users.EmailAddress = TRIM(EmailID)
AND partsorders.users.Password = TRIM(Pwd);

END
$$

DELIMITER ;

--
-- Create table `roles`
--
CREATE TABLE roles (
  RoleID BIGINT(20) NOT NULL AUTO_INCREMENT,
  RoleName VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL,
  IsActive BIT(1) DEFAULT NULL,
  PRIMARY KEY (RoleID)
)
ENGINE = INNODB,
AUTO_INCREMENT = 6,
AVG_ROW_LENGTH = 3276,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci,
COMMENT = 'defined static roles of users';

--
-- Create index `RoleName` on table `roles`
--
ALTER TABLE roles 
  ADD UNIQUE INDEX RoleName(RoleName);

--
-- Create table `userroles`
--
CREATE TABLE userroles (
  EmailAddress VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  RoleID BIGINT(20) NOT NULL DEFAULT 5,
  RecordID BIGINT(20) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (RecordID)
)
ENGINE = INNODB,
AUTO_INCREMENT = 17,
AVG_ROW_LENGTH = 1260,
CHARACTER SET latin1,
COLLATE latin1_swedish_ci,
COMMENT = 'Roles Assigned to users';

--
-- Create index `FK_userroles_user` on table `userroles`
--
ALTER TABLE userroles 
  ADD INDEX FK_userroles_user(EmailAddress);

--
-- Create foreign key
--
ALTER TABLE userroles 
  ADD CONSTRAINT FK_userroles_roles FOREIGN KEY (RoleID)
    REFERENCES roles(RoleID) ON UPDATE CASCADE;

--
-- Create foreign key
--
ALTER TABLE userroles 
  ADD CONSTRAINT FK_userroles_users FOREIGN KEY (EmailAddress)
    REFERENCES users(EmailAddress) ON UPDATE CASCADE;

--
-- Create view `view_all_users`
--
CREATE 
	DEFINER = 'root'@'localhost'
VIEW view_all_users
AS
SELECT
  `users`.`EmailAddress` AS `UserID`,
  `users`.`FullName` AS `FullName`,
  `users`.`IsActive` AS `IsActive`,
  `users`.`IsEnabled` AS `IsEnabled`,
  `users`.`IsAuthorized` AS `IsAuthorized`,
  `userroles`.`RoleID` AS `RoleID`,
  `roles`.`RoleName` AS `RoleName`
FROM ((`userroles`
  JOIN `users`
    ON ((`userroles`.`EmailAddress` = `users`.`EmailAddress`)))
  JOIN `roles`
    ON ((`userroles`.`RoleID` = `roles`.`RoleID`)))
ORDER BY `users`.`FullName`;

DELIMITER $$

--
-- Create procedure `getUserFullName`
--
CREATE DEFINER = 'root'@'localhost'
PROCEDURE getUserFullName(IN EmailID VARCHAR(100))
BEGIN

SELECT
  FullName
FROM view_all_users
WHERE UserID = EmailID LIMIT 1;

END
$$

DELIMITER ;

--
-- Create table `orderheader`
--
CREATE TABLE orderheader (
  OrderID BIGINT(20) NOT NULL AUTO_INCREMENT,
  JobCardNo VARCHAR(20) NOT NULL,
  CustomerName VARCHAR(255) DEFAULT NULL,
  RequestedBy VARCHAR(100) NOT NULL,
  RequestDate DATE NOT NULL,
  RequestTime TIME NOT NULL,
  Comments VARCHAR(255) DEFAULT NULL,
  LpoNumber VARCHAR(20) DEFAULT NULL,
  PRIMARY KEY (OrderID)
)
ENGINE = INNODB,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create index `IDX_orderrequestheader` on table `orderheader`
--
ALTER TABLE orderheader 
  ADD INDEX IDX_orderrequestheader(CustomerName, RequestedBy);

--
-- Create index `IDX_orderrequestheader_Comments` on table `orderheader`
--
ALTER TABLE orderheader 
  ADD INDEX IDX_orderrequestheader_Comments(Comments);

--
-- Create index `IDX_orderrequestheader_CustomerName` on table `orderheader`
--
ALTER TABLE orderheader 
  ADD INDEX IDX_orderrequestheader_CustomerName(CustomerName);

--
-- Create index `IDX_orderrequestheader_RequestedBy` on table `orderheader`
--
ALTER TABLE orderheader 
  ADD INDEX IDX_orderrequestheader_RequestedBy(RequestedBy);

--
-- Create index `JobCardNo` on table `orderheader`
--
ALTER TABLE orderheader 
  ADD UNIQUE INDEX JobCardNo(JobCardNo);

--
-- Create table `orderdetails`
--
CREATE TABLE orderdetails (
  OrderDetailsID BIGINT(20) NOT NULL AUTO_INCREMENT,
  OrderID BIGINT(20) NOT NULL,
  PartNumber VARCHAR(255) NOT NULL,
  PartName VARCHAR(255) DEFAULT NULL,
  PartQty BIGINT(20) NOT NULL DEFAULT 1,
  ServiceType VARCHAR(100) NOT NULL,
  LpoNumber VARCHAR(20) DEFAULT NULL,
  Brand VARCHAR(100) NOT NULL,
  Price DOUBLE DEFAULT 0,
  PRIMARY KEY (OrderDetailsID)
)
ENGINE = INNODB,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create index `IDX_orderdetails` on table `orderdetails`
--
ALTER TABLE orderdetails 
  ADD INDEX IDX_orderdetails(PartNumber, PartName, ServiceType, Brand);

--
-- Create index `IDX_orderdetails_LpoNumber` on table `orderdetails`
--
ALTER TABLE orderdetails 
  ADD INDEX IDX_orderdetails_LpoNumber(LpoNumber);

--
-- Create index `IDX_orderdetails_PartName` on table `orderdetails`
--
ALTER TABLE orderdetails 
  ADD INDEX IDX_orderdetails_PartName(PartName);

--
-- Create index `IDX_orderdetails_PartNumber` on table `orderdetails`
--
ALTER TABLE orderdetails 
  ADD INDEX IDX_orderdetails_PartNumber(PartNumber);

--
-- Create foreign key
--
ALTER TABLE orderdetails 
  ADD CONSTRAINT FK_orderdetails_OrderID FOREIGN KEY (OrderID)
    REFERENCES orderheader(OrderID) ON UPDATE CASCADE;

--
-- Create table `orderitemstatus`
--
CREATE TABLE orderitemstatus (
  RecID BIGINT(20) NOT NULL AUTO_INCREMENT,
  OrderID BIGINT(20) DEFAULT NULL,
  OrderDetailsID BIGINT(20) DEFAULT NULL,
  Requested BIT(1) DEFAULT b'1',
  Acknowledged BIT(1) DEFAULT b'0',
  Approved BIT(1) DEFAULT b'0',
  Ordered BIT(1) DEFAULT b'0',
  Arrived BIT(1) DEFAULT b'0',
  ReleaseRequest BIT(1) DEFAULT b'0',
  Released BIT(1) DEFAULT b'0',
  ETA VARCHAR(255) DEFAULT NULL,
  Comments VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (RecID)
)
ENGINE = INNODB,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE orderitemstatus 
  ADD CONSTRAINT FK_orderitemstatus_OrderDetailsID FOREIGN KEY (OrderDetailsID)
    REFERENCES orderdetails(OrderDetailsID) ON DELETE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE orderitemstatus 
  ADD CONSTRAINT FK_orderitemstatus_OrderID FOREIGN KEY (OrderID)
    REFERENCES orderheader(OrderID) ON DELETE NO ACTION;

CREATE USER ''@'localhost' IDENTIFIED WITH mysql_native_password;



CREATE USER 'almoesvc'@'%' IDENTIFIED WITH mysql_native_password;
GRANT Usage ON *.* TO 'almoesvc'@'%' 
WITH GRANT OPTION;
SET PASSWORD FOR 'almoesvc'@'%' = '*9DB3CD281E7F6F0F2CD9164CFD5835855753E762';
GRANT ALL PRIVILEGES ON *.* TO 'almoesvc'@'%';
GRANT Select, Insert, Update, Delete, Create, Drop, Grant Option, References, Index, Alter, Create Temporary Tables, Lock Tables, Create View, Show View, Create Routine, Alter Routine, Execute, Event, Trigger ON  almoeservice.* TO 'almoesvc'@'%';



CREATE USER 'pma'@'localhost' IDENTIFIED WITH mysql_native_password;
GRANT Select, Insert, Update, Delete, Execute ON  phpmyadmin.* TO 'pma'@'localhost';
GRANT Select (Host), Select (User), Select (Select_priv), Select (Insert_priv), Select (Update_priv), Select (Delete_priv), Select (Create_priv), Select (Drop_priv), Select (Reload_priv), Select (Shutdown_priv), Select (Process_priv), Select (File_priv), Select (Grant_priv), Select (References_priv), Select (Index_priv), Select (Alter_priv), Select (Show_db_priv), Select (Super_priv), Select (Create_tmp_table_priv), Select (Lock_tables_priv), Select (Execute_priv), Select (Repl_slave_priv), Select (Repl_client_priv) ON  mysql.user TO 'pma'@'localhost';
GRANT Select (Host), Select (Db), Select (User), Select (Table_name), Select (Table_priv), Select (Column_priv) ON  mysql.tables_priv TO 'pma'@'localhost';



CREATE USER 'root'@'%' IDENTIFIED WITH mysql_native_password;
GRANT Usage ON *.* TO 'root'@'%' 
WITH GRANT OPTION;
SET PASSWORD FOR 'root'@'%' = '*9DB3CD281E7F6F0F2CD9164CFD5835855753E762';
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%';



CREATE USER 'root'@'127.0.0.1' IDENTIFIED WITH mysql_native_password;
GRANT Usage ON *.* TO 'root'@'127.0.0.1' 
WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO 'root'@'127.0.0.1';



CREATE USER 'root'@'::1' IDENTIFIED WITH mysql_native_password;
GRANT Usage ON *.* TO 'root'@'::1' 
WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO 'root'@'::1';



CREATE USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password;
GRANT Usage ON *.* TO 'root'@'localhost' 
WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON *.* TO 'root'@'localhost';
GRANT PROXY ON ''@'' TO 'root'@'localhost' WITH GRANT OPTION;



-- 
-- Dumping data for table users
--
INSERT INTO users VALUES
('accounts.svc@almoe.com', 'Prasad', 'pa$$word', True, True, True),
('fathima@almoe.com', 'Fathima', 'pa$$word', True, True, True),
('geo@almoe.com', 'Geo James', 'pa$$word', True, True, True),
('glenn.a@almoe.com', 'Glenn Aglubat', 'pa$$word', True, True, True),
('neil.carroll@almoe.com', 'Neil Carroll', 'pa$$word', True, True, True),
('projectcoordinator.ads@almoe.com', 'Anas', 'pa$$word', True, True, True),
('ramachandran.k@almoe.com', 'Ramachandran K', 'pa$$word', True, True, True),
('riyas.a@almoe.com', 'Riyas Aboobaker', 'pa$$word', True, True, True),
('shijo.j@almoe.com', 'Shijo Jose', 'pa$$word', True, True, True),
('slpproject@almoe.com', 'SLP Project', 'pa$$word', True, True, True),
('support@almoe.com', 'Almoe Support', 'pa$$word', True, True, True),
('svccoordinator.ads@almoe.com', 'Swapna Nair', 'pa$$word', True, True, True),
('vijith.k@almoe.com', 'Vijith Nair', 'pa$$word', True, True, True);

-- 
-- Dumping data for table roles
--
INSERT INTO roles VALUES
(1, 'Administrators', True),
(2, 'Approvers', True),
(3, 'Initiators', True),
(4, 'Executers', True),
(5, 'Viewers', True);

-- 
-- Dumping data for table orderheader
--
-- Table partsorders.orderheader does not contain any data (it is empty)

-- 
-- Dumping data for table orderdetails
--
-- Table partsorders.orderdetails does not contain any data (it is empty)

-- 
-- Dumping data for table userroles
--
INSERT INTO userroles VALUES
('accounts.svc@almoe.com', 4, 3),
('fathima@almoe.com', 3, 4),
('geo@almoe.com', 5, 5),
('glenn.a@almoe.com', 5, 6),
('neil.carroll@almoe.com', 5, 7),
('projectcoordinator.ads@almoe.com', 3, 8),
('ramachandran.k@almoe.com', 5, 9),
('riyas.a@almoe.com', 1, 10),
('shijo.j@almoe.com', 5, 11),
('slpproject@almoe.com', 3, 12),
('support@almoe.com', 5, 13),
('svccoordinator.ads@almoe.com', 3, 14),
('vijith.k@almoe.com', 5, 15),
('riyas.a@almoe.com', 5, 16);

-- 
-- Dumping data for table orderitemstatus
--
-- Table partsorders.orderitemstatus does not contain any data (it is empty)

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;